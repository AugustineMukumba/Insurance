@using Insurance.Service;
@model InsuranceClaim.Models.ListPolicy
@{
    ViewBag.Title = "My Policies";
    Layout = "~/Views/Shared/_InsuranceMain.cshtml";
}



<div class="productsave-section">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-8 col-md-8 col-lg-8 products-top">
                <div class="head-title">
                    <h2>Policy List</h2>
                </div>
            </div>
            @*<div class="col-xs-12 col-sm-4 col-md-4 col-lg-4 add-btn">
                    <div class="text-right">
                        <form>
                            <input class="btn btn-primary" type="button" value="Add" onclick="window.location.href='@Url.Action("Index", "CustomerRegistration")'" />
                        </form>
                    </div>
                </div*@
        </div>
        <br />
        <br />

        <br />
        <br />
        <div class="policy-table-grid-main">
            <table class="table table-striped">

                <tbody>

                    @foreach (var item in Model.listpolicy.ToList())
                    {

                        <tr class="policyheading-tr">

                            <th>Policy Number</th>
                            <th>Customer Name</th>
                            <th>Payment Method</th>
                            <th>Total Sum Insured</th>
                            <th>Total Premium</th>


                        </tr>
                        <tr class="policynumber-tr">

                            <td>@item.PolicyNumber</td>
                            <td>@MiscellaneousService.GetCustomerNamebyID(item.CustomerId)</td>
                            <td>@MiscellaneousService.GetPaymentMethodNamebyID(item.PaymentMethodId)</td>
                            <td>$@item.TotalSumInsured</td>
                            <td>$@item.TotalPremium</td>

                        </tr>
                        <tr>
                            <td colspan="6">
                                <table class="policy-table-grid" style="width:100%">
                                    <tr>
                                        <th>Cover Type</th>
                                        <th>Is Reinsurance ?</th>
                                        <th>Vehicle Make</th>
                                        <th>Vehicle Model</th>
                                        <th>Reinsurance Amount</th>
                                        <th>Reinsurance Broker</th>
                                        <th>Sum Insured</th>
                                        <th>Premium</th>
                                        <th>Policy End Date</th>
                                        <th>Actions(s)</th>
                                    </tr>
                                    @foreach (var _item in item.Vehicles)
                                    {
                                        <tr>
                                            <td>@MiscellaneousService.GetCoverTypeNamebyID(_item.CoverType)</td>
                                            <td>@_item.isReinsurance</td>
                                            <td>@MiscellaneousService.GetMakeNamebyMakeCode(_item.MakeId)</td>
                                            <td>@MiscellaneousService.GetModelNamebyModelCode(_item.ModelId)</td>
                                            <td>@_item.ReinsuranceAmount</td>
                                            <td>@MiscellaneousService.GetReinsuranceBrokerNamebybrokerid(_item.ReinsurerBrokerId)</td>
                                            <td>$@_item.SumInsured</td>
                                            <td>$@_item.Premium</td>
                                            <td>@_item.enddate.ToString("dd/MM/yyy")</td>
                                            @if (_item.enddate < DateTime.Now)
                                            {
                                                <td>@Html.ActionLink("Renew", "RiskDetail", "Renew", new { id = _item.VehicleId }, new { @class = "btn-sm btn-primary" })</td>
                                            }

                                        </tr>
                                    }
                                </table>
                            </td>
                        </tr>
                    }
                </tbody>

            </table>
        </div>
    </div>

</div>





<div class="modal fade" id="mymodals" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="text-align: center;color: #00bcea;font-weight: bold;">Are you sure you want to delete this?</p>
            </div>
            <div class="modal-footer">
                <button type="button" id="deleteBtn" class="btn btn-danger" onclick="ConfirmDelete()">Yes</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>


<script>

    let CoverListId;
    function showPopupp(Id) {
        debugger;
        $("#mymodals").modal("show");
        CoverListId = Id;
    }
    function ConfirmDelete() {
        debugger;
        var url = '@Url.Action("DeleteRoleManagement", "Account", new {Id=1021 })';
        var newurl = url.replace("1021", CoverListId);
        window.location.href = newurl;
    }
</script>
